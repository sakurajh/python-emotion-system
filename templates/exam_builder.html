<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Teacher Console // æ•™å¸ˆç®¡ç†ç»ˆç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0f172a; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .glass { background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(56, 189, 248, 0.2); }
        .scroll-y::-webkit-scrollbar { width: 4px; }
        .scroll-y::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
    </style>
</head>
<body class="flex h-screen">

    <!-- 1. å·¦ä¾§ï¼šè¯•å·åº“ -->
    <div class="w-80 bg-slate-900 border-r border-slate-700 flex flex-col p-4 z-20 shadow-xl">
        <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-800">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center font-bold text-lg" id="avatar">T</div>
            <div>
                <div class="text-sm font-bold text-white" id="teacher-name">æœªç™»å½•</div>
                <div class="text-[10px] text-cyan-400 uppercase tracking-wider">TEACHER NODE</div>
            </div>
            <button onclick="createNewExam()" class="ml-auto bg-green-600 hover:bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg transition" title="æ–°å»ºè¯•å·"><i class="fa-solid fa-plus"></i></button>
        </div>
        <div class="text-[10px] text-gray-500 uppercase font-bold mb-3 flex justify-between">
            <span>MY EXAM LIBRARY</span>
            <button onclick="loadMyExams()" class="hover:text-white"><i class="fa-solid fa-rotate"></i></button>
        </div>
        <div id="exam-list" class="flex-1 overflow-y-auto scroll-y space-y-3 pr-1"></div>
        <button onclick="logout()" class="mt-4 w-full py-2 border border-red-900/50 text-red-500 text-xs rounded hover:bg-red-900/20 transition">EXIT SYSTEM</button>
    </div>

    <!-- 2. å³ä¾§ï¼šç¼–è¾‘å™¨å·¥ä½œå° -->
    <div class="flex-1 flex flex-col relative bg-slate-950">
        <div class="h-14 border-b border-slate-800 flex items-center px-8 justify-between bg-slate-900/50">
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500" id="mode-dot"></span>
                <span class="text-xs font-bold text-gray-400 uppercase" id="mode-text">CREATE MODE</span>
            </div>
            <div class="text-xs text-gray-500" id="current-id-display">NEW EXAM</div>
        </div>

        <div class="flex-1 p-8 overflow-y-auto scroll-y" id="editor-area">
            <div class="max-w-4xl mx-auto">
                <div class="mb-8 flex justify-between items-end gap-4">
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-500 uppercase font-bold mb-1 block tracking-wider">EXAM TITLE</label>
                        <input id="exam-title" type="text" placeholder="è¾“å…¥è¯•å·æ ‡é¢˜..." class="w-full bg-transparent border-b-2 border-slate-700 text-2xl font-bold py-2 focus:border-cyan-500 outline-none text-white transition placeholder-slate-700">
                    </div>
                    <div id="import-box">
                        <input type="file" id="file-upload" class="hidden" accept=".pdf,.docx" onchange="uploadAndParse(this)">
                        <button onclick="document.getElementById('file-upload').click()" class="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-purple-400 text-xs font-bold rounded border border-purple-500/30 flex items-center gap-2 transition"><i class="fa-solid fa-wand-magic-sparkles"></i> AI å¯¼å…¥</button>
                    </div>
                </div>
                <div id="questions-container" class="space-y-4 min-h-[300px] pb-20">
                    <div class="text-center text-slate-600 py-20 border-2 border-dashed border-slate-800 rounded-xl" id="empty-tip">ç‚¹å‡»ä¸‹æ–¹å·¥å…·æ æ·»åŠ é¢˜ç›®</div>
                </div>
            </div>
        </div>

        <div class="h-16 glass border-t border-slate-700 px-8 flex items-center justify-between absolute bottom-0 w-full z-10">
            <div class="flex gap-2">
                <button onclick="addQuestion('choice')" class="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded text-xs border border-slate-600 text-blue-400 font-bold">é€‰æ‹©</button>
                <button onclick="addQuestion('text')" class="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded text-xs border border-slate-600 text-green-400 font-bold">å¡«ç©º</button>
                <button onclick="addQuestion('photo')" class="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded text-xs border border-slate-600 text-yellow-400 font-bold">æ‹ç…§</button>
            </div>
            <div class="flex gap-4">
                <button onclick="cancelEdit()" id="btn-cancel" class="text-gray-500 text-xs hover:text-white hidden">å–æ¶ˆä¿®æ”¹</button>
                <button onclick="saveExam()" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded text-xs shadow-[0_0_15px_rgba(6,182,212,0.4)] flex items-center gap-2">
                    <i class="fa-solid fa-floppy-disk"></i> <span id="btn-save-text">å‘å¸ƒè¯•å·</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div id="auth-overlay" class="absolute inset-0 z-50 bg-slate-950/90 backdrop-blur-md flex items-center justify-center">
        <div class="bg-slate-900 p-8 rounded-2xl border border-cyan-500/30 w-96 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2"><i class="fa-solid fa-user-tie text-cyan-500"></i> æ•™å¸ˆéªŒè¯</h2>
            <div id="login-form" class="space-y-4">
                <input type="text" id="login-user" placeholder="è´¦å·" class="w-full bg-black/50 border border-slate-700 p-3 rounded text-sm text-white focus:border-cyan-500 outline-none">
                <input type="password" id="login-pass" placeholder="å¯†ç " class="w-full bg-black/50 border border-slate-700 p-3 rounded text-sm text-white focus:border-cyan-500 outline-none">
                <button onclick="doLogin()" class="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded font-bold transition">ç™» å½•</button>
                <div class="text-center text-xs text-gray-500 mt-4 cursor-pointer hover:text-cyan-400" onclick="switchMode('reg')">æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ</div>
            </div>
            <div id="reg-form" class="space-y-4 hidden">
                <input type="text" id="reg-user" placeholder="æ–°è´¦å·" class="w-full bg-black/50 border border-slate-700 p-3 rounded text-sm text-white focus:border-cyan-500 outline-none">
                <input type="password" id="reg-pass" placeholder="æ–°å¯†ç " class="w-full bg-black/50 border border-slate-700 p-3 rounded text-sm text-white focus:border-cyan-500 outline-none">
                <button onclick="doRegister()" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white rounded font-bold transition">æ³¨ å†Œ</button>
                <div class="text-center text-xs text-gray-500 mt-4 cursor-pointer hover:text-cyan-400" onclick="switchMode('login')">è¿”å›ç™»å½•</div>
            </div>
        </div>
    </div>

    <!-- ç­”å·æ•°æ®å¼¹çª— -->
    <div id="data-modal" class="fixed inset-0 z-30 bg-black/80 hidden items-center justify-center p-10">
        <div class="bg-slate-900 w-full max-w-3xl h-[80vh] rounded-2xl border border-slate-700 flex flex-col shadow-2xl relative">
            <div class="p-6 border-b border-slate-800 flex justify-between items-center bg-slate-800/50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-white">ç­”é¢˜ç»Ÿè®¡</h3>
                <button onclick="document.getElementById('data-modal').classList.replace('flex','hidden')" class="text-gray-500 hover:text-white text-2xl">Ã—</button>
            </div>
            <div class="p-6 overflow-y-auto scroll-y flex-1">
                <table class="w-full text-left text-sm text-gray-300">
                    <thead class="bg-slate-800 text-gray-400 uppercase font-bold text-xs"><tr><th class="p-3">å§“å</th><th class="p-3">æ—¶é—´</th><th class="p-3">ä¸“æ³¨åº¦</th><th class="p-3">æ“ä½œ</th></tr></thead>
                    <tbody id="result-tbody"></tbody>
                </table>
                <div id="no-data-tip" class="hidden text-center text-gray-500 mt-10">æš‚æ— æ•°æ®</div>
            </div>
        </div>
    </div>

    <!-- è¯¦ç»†æ—¥å¿—å¼¹çª— -->
    <div id="detail-modal" class="fixed inset-0 z-40 bg-black/90 hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-slate-950 w-full max-w-4xl h-[90vh] rounded-2xl border border-cyan-500/50 flex flex-col shadow-2xl">
            <div class="p-5 border-b border-slate-800 flex justify-between items-center bg-slate-900 rounded-t-2xl">
                <div><h3 class="text-xl font-bold text-white"><span id="detail-name">Student</span> çš„ç­”å·</h3><p class="text-xs text-gray-500 mt-1" id="detail-time">--</p></div>
                <button onclick="document.getElementById('detail-modal').classList.add('hidden')" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
            </div>
            <div class="flex-1 flex overflow-hidden">
                <div class="w-1/2 border-r border-slate-800 p-6 flex flex-col">
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-4">ä¸“æ³¨åº¦ç›‘æ§</h4>
                    <div id="detail-chart" class="flex-1 bg-slate-900/50 rounded-xl border border-slate-800"></div>
                </div>
                <div class="w-1/2 p-6 overflow-y-auto scroll-y bg-slate-900/30">
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-4">ç­”é¢˜å†…å®¹</h4>
                    <div id="detail-answers" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTeacher = localStorage.getItem('teacher_user');
        let currentExamId = null;
        let qCount = 0;
        let detailChart = null;

        // --- 1. è®¤è¯ ---
        function checkAuth() {
            if (currentTeacher) {
                document.getElementById('auth-overlay').classList.add('hidden');
                document.getElementById('teacher-name').innerText = currentTeacher;
                document.getElementById('avatar').innerText = currentTeacher[0].toUpperCase();
                loadMyExams();
            } else { document.getElementById('auth-overlay').classList.remove('hidden'); }
        }
        function switchMode(mode) { document.getElementById('login-form').classList.toggle('hidden', mode!=='login'); document.getElementById('reg-form').classList.toggle('hidden', mode!=='reg'); }
        async function doLogin() {
            const u = document.getElementById('login-user').value; const p = document.getElementById('login-pass').value;
            const fd = new FormData(); fd.append('username', u); fd.append('password', p);
            const res = await fetch('/api/login', { method:'POST', body:fd }); const data = await res.json();
            if(data.status==='success') { localStorage.setItem('teacher_user', u); currentTeacher = u; checkAuth(); } else Swal.fire('Error', data.message, 'error');
        }
        async function doRegister() {
            const u = document.getElementById('reg-user').value; const p = document.getElementById('reg-pass').value;
            const fd = new FormData(); fd.append('username', u); fd.append('password', p);
            const res = await fetch('/api/teacher/register', { method:'POST', body:fd }); const data = await res.json();
            if(data.status==='success') { Swal.fire('Success', 'è¯·ç™»å½•', 'success'); switchMode('login'); } else Swal.fire('Error', data.message, 'error');
        }
        function logout() { localStorage.removeItem('teacher_user'); location.reload(); }

        // --- 2. è¯•å·åˆ—è¡¨ ---
        async function loadMyExams() {
            if(!currentTeacher) return;
            const res = await fetch(`/api/exam/my_exams?username=${currentTeacher}`); const list = await res.json();
            const container = document.getElementById('exam-list'); container.innerHTML = "";
            if(list.length===0) container.innerHTML = `<div class="text-center text-gray-600 text-xs mt-4">æš‚æ— è¯•å·</div>`;
            list.forEach(exam => {
                container.innerHTML += `
                    <div class="bg-slate-800 p-3 rounded hover:bg-slate-700 border-l-2 border-slate-600 hover:border-cyan-500 group transition relative">
                        <div class="text-xs font-bold text-white truncate pr-16">${exam.title}</div>
                        <div class="text-[10px] text-gray-500 mt-1">${exam.date}</div>
                        <div class="absolute right-2 top-2 flex gap-1 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="editExam(${exam.id})" class="w-6 h-6 bg-blue-600 text-white rounded flex items-center justify-center hover:bg-blue-500"><i class="fa-solid fa-pen"></i></button>
                            <button onclick="showResults(${exam.id})" class="w-6 h-6 bg-green-600 text-white rounded flex items-center justify-center hover:bg-green-500"><i class="fa-solid fa-chart-bar"></i></button>
                            <button onclick="deleteExam(${exam.id})" class="w-6 h-6 bg-red-600 text-white rounded flex items-center justify-center hover:bg-red-500"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        // --- 3. ç¼–è¾‘é€»è¾‘ (ä¿®å¤ç‰ˆ) ---
        function createNewExam() {
            currentExamId = null;
            document.getElementById('exam-title').value = "";
            document.getElementById('questions-container').innerHTML = '<div class="text-center text-slate-600 py-20 border-2 border-dashed border-slate-800 rounded-xl" id="empty-tip">ç‚¹å‡»ä¸‹æ–¹å·¥å…·æ æ·»åŠ é¢˜ç›®</div>';
            qCount = 0; updateEditorStatus();
        }

        async function editExam(id) {
            currentExamId = id; updateEditorStatus();
            const res = await fetch(`/api/exam/detail/${id}`); const data = await res.json();
            if(data.status === 'success') {
                document.getElementById('exam-title').value = data.exam.title;
                document.getElementById('questions-container').innerHTML = '';
                qCount = 0;
                data.exam.questions.forEach(q => addQuestion(q.type, q.title, q.options));
            }
        }

        function updateEditorStatus() {
            const isEdit = !!currentExamId;
            document.getElementById('mode-dot').className = `w-2 h-2 rounded-full ${isEdit?'bg-yellow-500 animate-pulse':'bg-green-500'}`;
            document.getElementById('mode-text').innerText = isEdit ? "EDIT MODE" : "CREATE MODE";
            document.getElementById('current-id-display').innerText = isEdit ? `ID: ${currentExamId}` : "NEW EXAM";
            document.getElementById('btn-save-text').innerText = isEdit ? "ä¿å­˜ä¿®æ”¹" : "å‘å¸ƒè¯•å·";
            document.getElementById('btn-cancel').classList.toggle('hidden', !isEdit);
            document.getElementById('import-box').classList.toggle('hidden', isEdit);
        }
        function cancelEdit() { createNewExam(); }

        // ğŸŸ¢ æ ¸å¿ƒä¿®å¤ï¼šé˜²æ­¢ style æŠ¥é”™ï¼Œå¹¶æ”¯æŒ value å®‰å…¨èµ‹å€¼
        function addQuestion(type, title="", options="") {
            const tip = document.getElementById('empty-tip');
            if(tip) tip.style.display = 'none'; // ğŸ”´ ä¿®å¤ï¼šè¿™é‡ŒåŠ äº†æ£€æŸ¥

            qCount++;
            const container = document.getElementById('questions-container');
            const div = document.createElement('div');
            div.className = "bg-slate-900 p-5 rounded-lg border border-slate-700 relative group transition hover:border-cyan-500/30";
            div.dataset.type = type;

            let typeLabel = type==='choice'?'å•é€‰':(type==='text'?'å¡«ç©º':'æ‹ç…§');
            let color = type==='choice'?'text-blue-400':(type==='text'?'text-green-400':'text-yellow-400');

            let html = `
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] font-bold ${color} px-2 py-0.5 rounded border border-white/5">Q${qCount} ${typeLabel}</span>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-trash"></i></button>
                </div>
                <input type="text" class="q-title w-full bg-transparent text-sm text-white placeholder-slate-600 mb-3 outline-none" placeholder="è¾“å…¥é¢˜ç›®å†…å®¹...">
            `;

            if(type === 'choice') {
                html += `<input type="text" class="q-opt w-full bg-black/30 border border-slate-700 p-2 rounded text-xs text-gray-300 focus:border-blue-500 outline-none transition" placeholder="é€‰é¡¹ (ä¾‹å¦‚: A.å¯¹ï¼ŒB.é”™)">`;
            } else if (type === 'photo') {
                html += `<div class="p-3 border-2 border-dashed border-slate-800 rounded text-center text-[10px] text-gray-600 bg-slate-900/50">å­¦ç”Ÿç«¯æ˜¾ç¤ºæ‹ç…§ä¸Šä¼ æ§ä»¶</div>`;
            }

            div.innerHTML = html;

            // ğŸŸ¢ åç½®èµ‹å€¼ï¼šå®‰å…¨åœ°æŠŠå†…å®¹å¡«è¿›å»ï¼Œä¸æ€•ç‰¹æ®Šç¬¦å·
            div.querySelector('.q-title').value = title;
            if(type === 'choice') {
                div.querySelector('.q-opt').value = options;
            }

            container.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        async function saveExam() {
            const title = document.getElementById('exam-title').value;
            if(!title) return Swal.fire('è¯·è¾“å…¥æ ‡é¢˜');
            const questions = [];
            document.querySelectorAll('#questions-container > div').forEach(div => {
                if(div.id === 'empty-tip') return;
                const q = { type: div.dataset.type, title: div.querySelector('.q-title').value, options: div.querySelector('.q-opt') ? div.querySelector('.q-opt').value : null };
                questions.push(q);
            });
            if(questions.length === 0) return Swal.fire('è¯·æ·»åŠ é¢˜ç›®');

            const fd = new FormData(); fd.append('title', title); fd.append('questions', JSON.stringify(questions));
            let url = '/api/exam/publish';
            if(currentExamId) { url = '/api/exam/update'; fd.append('exam_id', currentExamId); }
            else fd.append('teacher_username', currentTeacher);

            const res = await fetch(url, { method:'POST', body:fd });
            const data = await res.json();
            if(data.status === 'success') {
                Swal.fire({icon:'success', title:'ä¿å­˜æˆåŠŸ', timer:1000, showConfirmButton:false});
                loadMyExams();
                if(!currentExamId) createNewExam();
            }
        }

        async function deleteExam(id) {
            const r = await Swal.fire({title:'ç¡®è®¤åˆ é™¤?', icon:'warning', showCancelButton:true, confirmButtonColor:'#d33'});
            if(r.isConfirmed) {
                const fd = new FormData(); fd.append('exam_id', id);
                await fetch('/api/exam/delete', {method:'POST', body:fd});
                loadMyExams(); if(currentExamId == id) createNewExam();
            }
        }

        // --- 4. æ•°æ®å±•ç¤º ---
        async function showResults(id) {
            const modal = document.getElementById('data-modal');
            const tbody = document.getElementById('result-tbody');
            const noData = document.getElementById('no-data-tip');
            modal.classList.replace('hidden', 'flex');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center p-4">åŠ è½½ä¸­...</td></tr>';

            const res = await fetch(`/api/exam/results/${id}`);
            const data = await res.json();

            tbody.innerHTML = '';
            if(data.results.length === 0) noData.classList.remove('hidden');
            else {
                noData.classList.add('hidden');
                data.results.forEach(r => {
                    let scoreClass = r.score > 80 ? 'text-green-400' : (r.score > 60 ? 'text-yellow-400' : 'text-red-400');
                    tbody.innerHTML += `
                        <tr class="border-b border-slate-800 hover:bg-slate-800/50 transition">
                            <td class="p-3 font-bold text-white">${r.student}</td>
                            <td class="p-3 text-xs text-gray-500">${r.time}</td>
                            <td class="p-3 ${scoreClass} font-mono">${r.score}%</td>
                            <td class="p-3"><button onclick="showDetail(${r.id})" class="text-xs bg-cyan-900/30 text-cyan-400 px-3 py-1 rounded border border-cyan-800 hover:bg-cyan-600 hover:text-white transition">è¯¦ç»†æ—¥å¿—</button></td>
                        </tr>`;
                });
            }
        }

        async function showDetail(resultId) {
            document.getElementById('detail-modal').classList.remove('hidden');
            document.getElementById('detail-name').innerText = "Loading...";
            document.getElementById('detail-answers').innerHTML = "<div class='text-gray-500 text-center mt-10'>åŠ è½½æ•°æ®ä¸­...</div>";

            const res = await fetch(`/api/exam/result_detail/${resultId}`);
            const json = await res.json();

            if(json.status === 'success') {
                const data = json.data;
                document.getElementById('detail-name').innerText = data.student;
                document.getElementById('detail-time').innerText = data.submit_time;

                const ansBox = document.getElementById('detail-answers');
                ansBox.innerHTML = "";
                if (Object.keys(data.answers).length === 0) ansBox.innerHTML = `<div class="text-gray-500 text-xs italic">æ— ç­”æ¡ˆè®°å½•</div>`;
                else {
                    for (const [key, val] of Object.entries(data.answers)) {
                        ansBox.innerHTML += `<div class="bg-slate-800 p-3 rounded border border-slate-700"><div class="text-xs text-gray-400 mb-1">${key}</div><div class="text-sm text-white">${val}</div></div>`;
                    }
                }

                const chartDom = document.getElementById('detail-chart');
                if (detailChart) detailChart.dispose();
                detailChart = echarts.init(chartDom);
                const logs = data.emotion_log;
                const option = {
                    tooltip: { trigger: 'axis' }, grid: { top: 20, bottom: 20, left: 40, right: 10 },
                    xAxis: { type: 'category', data: logs.map(l => l.time+'s'), show: false },
                    yAxis: { type: 'value', min: 0, max: 100, splitLine: { lineStyle: { color: '#334155' } } },
                    series: [{ data: logs.map(l => l.score), type: 'line', smooth: true, lineStyle: { color: '#06b6d4', width: 3 }, areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:'rgba(6,182,212,0.5)'},{offset:1,color:'transparent'}]) }, markPoint: { data: [{ type: 'min', name: 'æœ€ä½' }, { type: 'max', name: 'æœ€é«˜' }] } }]
                };
                detailChart.setOption(option);
            }
        }

        async function uploadAndParse(input) {
            const file = input.files[0];
            if (!file) return;
            Swal.fire({title: 'AI è§£æä¸­...', didOpen: () => Swal.showLoading(), background:'#0f172a', color:'#fff'});
            const fd = new FormData(); fd.append('file', file);
            try {
                const res = await fetch('/api/exam/import_file', { method: 'POST', body: fd });
                const data = await res.json();
                if(data.status === 'success') {
                    Swal.close();
                    data.questions.forEach(q => addQuestion(q.type, q.title, q.options));
                } else { Swal.fire('è§£æå¤±è´¥', data.message, 'error'); }
            } catch(e) { Swal.fire('é”™è¯¯', e.message, 'error'); }
            input.value = '';
        }

        checkAuth();
        window.addEventListener('resize', () => { if(detailChart) detailChart.resize(); });
    </script>
</body>
</html>